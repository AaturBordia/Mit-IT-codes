Lab 3-additional

CREATE TABLE CUSTOMER (
    cust INT PRIMARY KEY,
    cname VARCHAR(50),
    city VARCHAR(30)
);


CREATE TABLE ORDERS (
    order_ INT PRIMARY KEY,
    odate DATE,
    cust INT,
    ordamt INT,
    FOREIGN KEY (cust) REFERENCES CUSTOMER(cust)
);


CREATE TABLE ITEM (
    item INT PRIMARY KEY,
    unitprice INT
);


CREATE TABLE ORDER_ITEMS (
    order_ INT,
    item INT,
    qty INT,
    PRIMARY KEY (order_, item),
    FOREIGN KEY (order_) REFERENCES ORDERS(order_),
    FOREIGN KEY (item) REFERENCES ITEM(item)
);


CREATE TABLE SHIPMENT (
    order_ INT,
    warehouse INT,
    shipdate DATE,
    PRIMARY KEY (order_, warehouse),
    FOREIGN KEY (order_) REFERENCES ORDERS(order_)
);

CREATE TABLE WAREHOUSE (
    warehouse INT PRIMARY KEY,
    city VARCHAR(30)
);


INSERT INTO CUSTOMER VALUES (1, 'Rahul Sharma', 'Delhi');
INSERT INTO CUSTOMER VALUES (2, 'Priya Verma', 'Mumbai');
INSERT INTO CUSTOMER VALUES (3, 'Amit Singh', 'Bangalore');
INSERT INTO CUSTOMER VALUES (4, 'Meera Patel', 'Ahmedabad');
INSERT INTO CUSTOMER VALUES (5, 'Rajesh Gupta', 'Kolkata');

INSERT INTO ORDERS VALUES (101,'17-AUG-2023', 1, 500);
INSERT INTO ORDERS VALUES (102,'18-AUG-2023', 2, 750);
INSERT INTO ORDERS VALUES (103,'19-AUG-2023', 1, 300);
INSERT INTO ORDERS VALUES (104,'20-AUG-2023', 3, 600);
INSERT INTO ORDERS VALUES (105,'21-AUG-2023', 4, 400);


INSERT INTO ITEM VALUES (201, 10);
INSERT INTO ITEM VALUES (202, 20);
INSERT INTO ITEM VALUES (203, 15);
INSERT INTO ITEM VALUES (204, 25);
INSERT INTO ITEM VALUES (205, 30);


INSERT INTO ORDER_ITEMS VALUES (101, 201, 5);
INSERT INTO ORDER_ITEMS VALUES (101, 202, 3);
INSERT INTO ORDER_ITEMS VALUES (102, 203, 7);
INSERT INTO ORDER_ITEMS VALUES (103, 201, 2);
INSERT INTO ORDER_ITEMS VALUES (104, 204, 4);


INSERT INTO SHIPMENT VALUES (101, 1,'17-AUG-2023');
INSERT INTO SHIPMENT VALUES (102, 2,'18-AUG-2023');
INSERT INTO SHIPMENT VALUES (103, 1,'17-AUG-2023');
INSERT INTO SHIPMENT VALUES (104, 3,'19-AUG-2023');
INSERT INTO SHIPMENT VALUES (105, 4,'20-AUG-2023');


INSERT INTO WAREHOUSE VALUES (1, 'Delhi');
INSERT INTO WAREHOUSE VALUES (2, 'Mumbai');
INSERT INTO WAREHOUSE VALUES (3, 'Bangalore');
INSERT INTO WAREHOUSE VALUES (4, 'Ahmedabad');
INSERT INTO WAREHOUSE VALUES (5, 'Kolkata');


1.
SELECT C.cname AS CUSTNAME, COUNT(O.order_) AS No_of_Orders, AVG(O.ordamt) AS AVG_ORDER_AMT FROM CUSTOMER C LEFT JOIN ORDERS O ON C.cust = O.cust GROUP BY C.cname;
or
select cname,count(order_),avg(ordamt)
from customer natural join orders
group by cname;

2.
SELECT DISTINCT O.order_ FROM ORDERS O WHERE NOT EXISTS (SELECT W.warehouse FROM WAREHOUSE W WHERE W.city = 'Bangalore' AND W.warehouse NOT IN (SELECT S.warehouse FROM SHIPMENT S WHERE S.order_ = O.order_));
or
select order_
from shipment natural join warehouse
where city='Bangalore';

3.
UPDATE ORDERS SET ordamt = CASE WHEN EXISTS (SELECT 1 FROM ORDER_ITEMS WHERE order_ = ORDERS.order_ AND qty > 10) THEN ordamt * 0.90 ELSE ordamt * 0.95 END;
